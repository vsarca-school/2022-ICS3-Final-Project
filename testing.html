<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <title>ICS Final Project</title>
    <script src="gpu.js/dist/gpu-browser.min.js"> // Libary for fast computation </script>
    <script>
        // GPU is a constructor and namespace for browser
        /*
        const generateMatrices = () => {
            const matrices = [[], []]
            for (let y = 0; y < 512; y++){
            matrices[0].push([])
            matrices[1].push([])
            for (let x = 0; x < 512; x++){
                matrices[0][y].push(Math.random())
                matrices[1][y].push(Math.random())
            }
            }
            return matrices
        }

        
        class thing {
            constructor() {
                this.gpu = new GPU();
                this.multiplyMatrix = [];
                for (let i=0; i<10; i++)
                {
                    this.multiplyMatrix.push(eval(`this.gpu.createKernel(function(a,b) {
                        return a[this.thread.x]*b[this.thread.x];
                    }).setOutput([10])`));
                }
                console.log(this.multiplyMatrix[0]([0,1,2,3,4,5,6,7,8,9],[0,1,2,3,4,5,6,7,8,9]));
            }
        }

        t = new thing();
        const matrices = generateMatrices();
        const out = t.multiplyMatrix[0]([0,1,2,3,4,5,6,7,8,9],[0,1,2,3,4,5,6,7,8,9]);
        console.log(out); //*/
    </script>

    <script src="LearnAI.js"></script>
    <script src="mnist_784_json - 10k.json"></script>
    <!--script src="C:\Users\vsarca\Downloads\Neural-Network-Experiments-2e28014ede7ae696cdccba2783a40352200ac14b\Neural-Network-Experiments-2e28014ede7ae696cdccba2783a40352200ac14b\Assets\Data\Mnist\Trained Networks\Mnist Net.json"></script-->
    <script>
        // We will eventually get our digits from here: https://pkgstore.datahub.io/machine-learning/mnist_784/mnist_784_json/data/617bd9fcff01b7d3621d67cef6405d12/mnist_784_json.json

        let dataset=[[], []];
        for (let i=0; i<10000; i++)
        {
            // answer
            dataset[1].push([0,0,0,0,0,0,0,0,0,0]);
            dataset[1][i][data[i].class] = 1;
            
            // image
            dataset[0].push([]);
            for (let j=1; j<=784; j++)
            {
                dataset[0][i].push(data[i]["pixel"+j.toString()]/255);
            }
        }

        // For rendering our dataset in the console
        let imagenumber = 0;
        function drawImage() {
            let image = "";
            for (let i=0; i<28; i++)
            {
                for (let j=0; j<28; j++)
                {
                    let value = dataset[0][imagenumber][28*i + j];
                    if (value < 0.19)
                        image += " ";
                    else if (value < 0.38)
                        image += ".";
                    else if (value < 0.57)
                        image += "-";
                    else if (value < 0.76)
                        image += "*";
                    else if (value < 0.95)
                        image += "?";
                    else
                        image += "#";
                }
                image += "\n";
            }
            console.log(image, "Answer is", data[imagenumber].class);
            imagenumber++;
        }

        //NeuralNetwork.print();

        nn = new NeuralNetwork(784, 10).randomize().generateGPU();

        console.log(nn.runNetwork(dataset[0][0]), "is the result for", dataset[0][0]);
        
        //DeepLearner.print();

        dl = new DeepLearner(nn, dataset, { learnrate: 1, batchsize: 100, batchsplit: 0.8, maxIncorrectGuessesToPrint: 1 });
        
        //console.log("Network gets", dl.countAll(), "/ 1000 test cases correct");
        let trainer = dl.train(800);
        setTimeout(function () { clearInterval(trainer); dl.test(); }, 300000);
        //let tester = setInterval(function () { console.log("Network gets", dl.countAll(), "/ 1000 test cases correct"); }, 10000);
        //let printer = setInterval(function () { console.log("Weights:", nn.layerweights, ", Biases:", nn.layerbiases); }, 10000);
        //dl.trainOnce();
        //dl.trainOnce();
        //dl.trainOnce();
    </script>
</head>

<body>
    <p>This is our ICS final project!</p>
</body>
</html>